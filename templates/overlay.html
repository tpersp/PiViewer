{% extends "base.html" %}
{% block title %}Overlay Configuration{% endblock %}
{% block content %}
<div class="page-section">
  <h2>Overlay Configuration</h2>
  <form method="GET" action="{{ url_for('main.overlay_config') }}">
    <label for="monitorSelect">Select Monitor:</label>
    <select id="monitorSelect" name="monitor" onchange="this.form.submit()">
      <option value="All" {% if selected_monitor == "All" %}selected{% endif %}>All Monitors (Global Settings)</option>
      {% for mname, minfo in monitors.items() %}
        <option value="{{ mname }}" {% if selected_monitor == mname %}selected{% endif %}>{{ mname }} ({{ minfo.resolution }})</option>
      {% endfor %}
    </select>
  </form>
  <hr>
  <form method="POST" action="{{ url_for('main.overlay_config', monitor=selected_monitor) }}">
    <input type="hidden" name="selected_monitor" value="{{ selected_monitor }}">
    <h3>Overlay Settings for {% if selected_monitor == "All" %}All Monitors{% else %}{{ selected_monitor }}{% endif %}</h3>
    <div class="form-group">
      <label><input type="checkbox" name="overlay_enabled" {% if overlay.overlay_enabled %}checked{% endif %}> Enable Overlay</label>
    </div>
    <div class="form-group">
      <label><input type="checkbox" name="clock_enabled" {% if overlay.clock_enabled %}checked{% endif %}> Show Clock</label>
    </div>
    <div class="form-group">
      <label><input type="checkbox" name="weather_enabled" {% if overlay.weather_enabled %}checked{% endif %}> Show Weather</label>
    </div>
    <div class="form-group">
      <label><input type="checkbox" name="background_enabled" {% if overlay.background_enabled %}checked{% endif %}> Show Background Box</label>
    </div>
    <div class="form-group">
      <label>Clock Font Size:</label>
      <input type="number" name="clock_font_size" value="{{ overlay.clock_font_size|default(26) }}">
    </div>
    <div class="form-group">
      <label>Weather Font Size:</label>
      <input type="number" name="weather_font_size" value="{{ overlay.weather_font_size|default(22) }}">
    </div>
    <div class="form-group">
      <label>Font Color:</label>
      <input type="color" name="font_color" value="{{ overlay.font_color|default('#FFFFFF') }}">
    </div>
    <div class="form-group">
      <label>Layout Style:</label>
      <select name="layout_style">
        <option value="stacked" {% if overlay.layout_style == "stacked" %}selected{% endif %}>Stacked</option>
        <option value="inline" {% if overlay.layout_style == "inline" %}selected{% endif %}>Inline</option>
      </select>
    </div>
    <div class="form-group">
      <label>Padding X:</label>
      <input type="number" name="padding_x" value="{{ overlay.padding_x|default(8) }}">
    </div>
    <div class="form-group">
      <label>Padding Y:</label>
      <input type="number" name="padding_y" value="{{ overlay.padding_y|default(6) }}">
    </div>
    <div class="form-group">
      <label><input type="checkbox" id="auto_scale" name="auto_scale" {% if overlay.auto_scale %}checked{% endif %}> Auto Scale Overlay Box</label>
    </div>
    <div id="manual_size_fields" {% if overlay.auto_scale %}style="display:none;"{% endif %}>
      <div class="form-group">
        <label>Offset X:</label>
        <input type="number" name="offset_x" value="{{ overlay.offset_x|default(20) }}">
      </div>
      <div class="form-group">
        <label>Offset Y:</label>
        <input type="number" name="offset_y" value="{{ overlay.offset_y|default(20) }}">
      </div>
      <div class="form-group">
        <label>Overlay Width:</label>
        <input type="number" name="overlay_width" value="{{ overlay.overlay_width|default(300) }}">
      </div>
      <div class="form-group">
        <label>Overlay Height:</label>
        <input type="number" name="overlay_height" value="{{ overlay.overlay_height|default(150) }}">
      </div>
    </div>
    <div class="form-group">
      <label>Background Color:</label>
      <input type="color" name="bg_color" value="{{ overlay.bg_color|default('#000000') }}">
    </div>
    <div class="form-group">
      <label>Background Opacity (0-1):</label>
      <input type="text" name="bg_opacity" value="{{ overlay.bg_opacity|default(0.4) }}">
    </div>
    <br>
    <button type="submit">Save Overlay Settings</button>
  </form>
  <hr>
  <h3>Preview</h3>
  <div class="overlay-preview-container" style="border:1px solid #ccc; padding:10px; display:inline-block;">
    <p>Monitor Preview (Scaled to {{ preview_size.width }}x{{ preview_size.height }})</p>
    <div style="position: relative; width: {{ preview_size.width }}px; height: {{ preview_size.height }}px; background: #333;">
      <div style="position: absolute; left: {{ preview_overlay.left }}px; top: {{ preview_overlay.top }}px; width: {{ preview_overlay.width }}px; height: {{ preview_overlay.height }}px; border: 2px dashed lime;"></div>
    </div>
  </div>
</div>
<script>
document.getElementById("auto_scale").addEventListener("change", function(){
  var manualFields = document.getElementById("manual_size_fields");
  if(this.checked){
    manualFields.style.display = "none";
  } else {
    manualFields.style.display = "block";
  }
});
</script>
{% endblock %}
