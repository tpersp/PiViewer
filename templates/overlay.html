{% extends "base.html" %}
{% block title %}Overlay Configuration{% endblock %}
{% block content %}
<div class="page-section" style="max-width:1200px;">
  <h2>Overlay Configuration</h2>
  <form method="POST" action="{{ url_for('main.overlay_config') }}">
    <div class="cards-container" style="display:flex; flex-wrap:wrap; gap:20px;">
      {% for monitor_name, monitor_cfg in monitors.items() %}
      <div class="card" style="flex: 1 1 300px; margin-bottom:20px; padding:15px; border:1px solid #ccc; border-radius:8px;">
        <h3>{{ monitor_name }} ({{ monitor_cfg.screen_name }})</h3>
        <!-- Removed enable overlay option -->
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_clock_enabled" {% if monitor_cfg.overlay and monitor_cfg.overlay.clock_enabled %}checked{% endif %}>
            Show Clock
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_weather_enabled" {% if monitor_cfg.overlay and monitor_cfg.overlay.weather_enabled %}checked{% endif %}>
            Show Weather
          </label>
        </div>
        <div class="form-group">
          <label>Clock Font Size:</label>
          <input type="number" name="{{ monitor_name }}_clock_font_size" value="{{ monitor_cfg.overlay.clock_font_size if monitor_cfg.overlay and monitor_cfg.overlay.clock_font_size is defined else 26 }}">
        </div>
        <div class="form-group">
          <label>Weather Font Size:</label>
          <input type="number" name="{{ monitor_name }}_weather_font_size" value="{{ monitor_cfg.overlay.weather_font_size if monitor_cfg.overlay and monitor_cfg.overlay.weather_font_size is defined else 22 }}">
        </div>
        <div class="form-group">
          <label>Font Color:</label>
          <input type="color" name="{{ monitor_name }}_font_color" value="{{ monitor_cfg.overlay.font_color if monitor_cfg.overlay and monitor_cfg.overlay.font_color is defined else '#FFFFFF' }}">
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_auto_negative_font" {% if monitor_cfg.overlay and monitor_cfg.overlay.auto_negative_font %}checked{% endif %}>
            Auto Negative Font Color
          </label>
        </div>
        <!-- Clock Position, label above the mini-screen -->
        <div class="form-group">
          <label>Clock Position:</label>
          <div class="mini-screen">
            <div id="{{ monitor_name }}_clockPosGrid" class="position-grid">
              <div class="pos-dot" data-pos="top-left"></div>
              <div class="pos-dot" data-pos="top-center"></div>
              <div class="pos-dot" data-pos="top-right"></div>
              <div class="pos-dot" data-pos="bottom-left"></div>
              <div class="pos-dot" data-pos="bottom-center"></div>
              <div class="pos-dot" data-pos="bottom-right"></div>
            </div>
          </div>
          <input type="hidden"
                 id="{{ monitor_name }}_clockPosInput"
                 name="{{ monitor_name }}_clock_position"
                 value="{% if monitor_cfg.overlay and monitor_cfg.overlay.clock_position is defined %}{{ monitor_cfg.overlay.clock_position }}{% else %}bottom-center{% endif %}">
        </div>
        <!-- Weather Position, label above the mini-screen -->
        <div class="form-group">
          <label>Weather Position:</label>
          <div class="mini-screen">
            <div id="{{ monitor_name }}_weatherPosGrid" class="position-grid">
              <div class="pos-dot" data-pos="top-left"></div>
              <div class="pos-dot" data-pos="top-center"></div>
              <div class="pos-dot" data-pos="top-right"></div>
              <div class="pos-dot" data-pos="bottom-left"></div>
              <div class="pos-dot" data-pos="bottom-center"></div>
              <div class="pos-dot" data-pos="bottom-right"></div>
            </div>
          </div>
          <input type="hidden"
                 id="{{ monitor_name }}_weatherPosInput"
                 name="{{ monitor_name }}_weather_position"
                 value="{% if monitor_cfg.overlay and monitor_cfg.overlay.weather_position is defined %}{{ monitor_cfg.overlay.weather_position }}{% else %}bottom-center{% endif %}">
        </div>
        <div class="form-group">
          <label>Weather Layout:</label>
          <select name="{{ monitor_name }}_weather_layout">
            <option value="inline" {% if monitor_cfg.overlay and monitor_cfg.overlay.weather_layout == "inline" %}selected{% endif %}>Inline</option>
            <option value="stacked" {% if monitor_cfg.overlay and monitor_cfg.overlay.weather_layout == "stacked" %}selected{% endif %}>Stacked</option>
          </select>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_show_desc" {% if monitor_cfg.overlay and monitor_cfg.overlay.show_desc %}checked{% endif %}>
            Show Weather Description
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_show_temp" {% if monitor_cfg.overlay and monitor_cfg.overlay.show_temp %}checked{% endif %}>
            Show Temperature
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_show_feels_like" {% if monitor_cfg.overlay and monitor_cfg.overlay.show_feels_like %}checked{% endif %}>
            Show Feels Like Temperature
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_show_humidity" {% if monitor_cfg.overlay and monitor_cfg.overlay.show_humidity %}checked{% endif %}>
            Show Humidity
          </label>
        </div>
        <script>
          document.addEventListener("DOMContentLoaded", function(){
            initPositionGrid(
              "{{ monitor_name }}_clockPosGrid",
              "{{ monitor_name }}_clockPosInput",
              "{% if monitor_cfg.overlay and monitor_cfg.overlay.clock_position is defined %}{{ monitor_cfg.overlay.clock_position }}{% else %}bottom-center{% endif %}"
            );
            initPositionGrid(
              "{{ monitor_name }}_weatherPosGrid",
              "{{ monitor_name }}_weatherPosInput",
              "{% if monitor_cfg.overlay and monitor_cfg.overlay.weather_position is defined %}{{ monitor_cfg.overlay.weather_position }}{% else %}bottom-center{% endif %}"
            );
          });
        </script>
      </div>
      {% endfor %}
    </div>
    <div style="text-align:center; margin-top:20px;">
      <button type="submit">Save All Overlay Settings</button>
    </div>
  </form>
</div>
{% endblock %}
