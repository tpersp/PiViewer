{% extends "base.html" %}
{% block title %}Overlay Settings{% endblock %}
{% block content %}

<div class="page-section">
  <h2>Overlay Settings</h2>

  <!-- Monitor Selection Form -->
  <form method="POST" id="monitorSelectForm">
    <input type="hidden" name="action" value="select_monitor">
    <label>Monitor(s):</label><br>
    <select name="monitor_selection" onchange="onMonitorChange()">
      <option value="All" {% if overlay.monitor_selection == "All" %}selected{% endif %}>All (combined)</option>
      {% for mname, minfo in monitors.items() %}
        <option value="{{mname}}" {% if overlay.monitor_selection == mname %}selected{% endif %}>
          {{mname}} ({{minfo.resolution}})
        </option>
      {% endfor %}
    </select>
  </form>

  <!-- Main Overlay Config Form -->
  <form method="POST" style="margin-top:20px;">
    <input type="hidden" name="action" value="save_overlay">

    <!-- Toggles -->
    <fieldset style="margin-bottom:15px;">
      <legend>Overlay Toggles</legend>
      <label>
        <input type="checkbox" name="overlay_enabled" {% if overlay.overlay_enabled %}checked{% endif %}>
        Enable Overlay
      </label>
      <br>
      <label>
        <input type="checkbox" name="clock_enabled" {% if overlay.clock_enabled %}checked{% endif %}>
        Show Clock
      </label>
      <br>
      <label>
        <input type="checkbox" name="weather_enabled" {% if overlay.weather_enabled %}checked{% endif %}>
        Show Weather
      </label>
      <br>
      <label>
        <input type="checkbox" name="background_enabled" {% if overlay.background_enabled %}checked{% endif %}>
        Show Background Box
      </label>
    </fieldset>

    <!-- Layout & Fonts -->
    <fieldset style="margin-bottom:15px;">
      <legend>Layout & Fonts</legend>
      <label>Clock Font Size:</label><br>
      <input type="number" name="clock_font_size" value="{{ overlay.clock_font_size|default(26) }}">
      <br><br>

      <label>Weather Font Size:</label><br>
      <input type="number" name="weather_font_size" value="{{ overlay.weather_font_size|default(22) }}">
      <br><br>

      <label>Font Color:</label><br>
      <input type="color" name="font_color" value="{{ overlay.font_color|default('#FFFFFF') }}">
      <br><br>

      <label>Layout Style:</label><br>
      <select name="layout_style">
        <option value="stacked" {% if overlay.layout_style == "stacked" %}selected{% endif %}>Stacked</option>
        <option value="inline" {% if overlay.layout_style == "inline" %}selected{% endif %}>Inline</option>
      </select>
      <br><br>

      <label>Padding X:</label><br>
      <input type="number" name="padding_x" value="{{ overlay.padding_x|default(8) }}">
      <br><br>

      <label>Padding Y:</label><br>
      <input type="number" name="padding_y" value="{{ overlay.padding_y|default(6) }}">
    </fieldset>

    <!-- Weather Details -->
    <fieldset style="margin-bottom:15px;">
      <legend>Weather Details</legend>
      <label>
        <input type="checkbox" name="show_desc" {% if overlay.show_desc %}checked{% endif %}>
        Description (e.g. "Cloudy")
      </label>
      <br>
      <label>
        <input type="checkbox" name="show_temp" {% if overlay.show_temp %}checked{% endif %}>
        Temperature
      </label>
      <br>
      <label>
        <input type="checkbox" name="show_feels_like" {% if overlay.show_feels_like %}checked{% endif %}>
        Feels Like
      </label>
      <br>
      <label>
        <input type="checkbox" name="show_humidity" {% if overlay.show_humidity %}checked{% endif %}>
        Humidity
      </label>
    </fieldset>

    <!-- Box Position & Size -->
    <fieldset>
      <legend>Box Position & Size</legend>
      <label>Offset X:</label><br>
      <input type="number" name="offset_x" id="offset_x" value="{{ overlay.offset_x|default('20') }}">
      <br><br>

      <label>Offset Y:</label><br>
      <input type="number" name="offset_y" id="offset_y" value="{{ overlay.offset_y|default('20') }}">
      <br><br>

      <label>Overlay Width:</label><br>
      <input type="number" name="overlay_width" id="overlay_width" value="{{ overlay.overlay_width|default('300') }}">
      <br><br>

      <label>Overlay Height:</label><br>
      <input type="number" name="overlay_height" id="overlay_height" value="{{ overlay.overlay_height|default('150') }}">
      <br><br>

      <label>Background Color:</label><br>
      <input type="color" name="bg_color" value="{{ overlay.bg_color|default('#000000') }}">
      <br><br>

      <label>Background Opacity (0-1):</label><br>
      <input type="text" name="bg_opacity" value="{{ overlay.bg_opacity|default(0.4) }}">
    </fieldset>

    <br>
    <button type="submit">Save Overlay Settings</button>
  </form>
</div>

<!-- Overlay Preview -->
<div class="overlay-preview-container">
  <p style="margin-bottom:10px; font-size:14px;">
    Drag the green box to place the overlay within the scaled monitor preview:
  </p>
  <div
    class="overlay-preview-box"
    id="overlayPreviewBox"
    style="width: {{ preview_size.width }}px; height: {{ preview_size.height }}px;"
  >
    <div
      class="overlay-draggable-box"
      id="overlayDraggable"
      style="
        width: {{ preview_overlay.width }}px;
        height: {{ preview_overlay.height }}px;
        left: {{ preview_overlay.left }}px;
        top: {{ preview_overlay.top }}px;
      "
    ></div>
  </div>
</div>

<p style="font-size:14px; color:var(--text-normal); margin-top:30px;">
  Note: For actual transparency, you must run a compositing manager like <strong>picom</strong>.
</p>

{% endblock %}
