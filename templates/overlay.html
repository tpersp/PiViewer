{% extends "base.html" %}
{% block title %}Overlay Configuration{% endblock %}
{% block content %}
<div class="page-section" style="max-width:1200px;">
  <h2>Overlay Configuration</h2>
  <form method="POST" action="{{ url_for('main.overlay_config') }}">
    <div class="cards-container" style="display:flex; flex-wrap:wrap; gap:20px;">
      {% for monitor_name, monitor_cfg in monitors.items() %}
      <div class="card" style="flex: 1 1 300px; margin-bottom:20px; padding:15px; border:1px solid #ccc; border-radius:8px;">
        <h3>{{ monitor_name }} ({{ monitor_cfg.screen_name }})</h3>
        <!-- Removed enable overlay option -->
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_clock_enabled" {% if monitor_cfg.overlay and monitor_cfg.overlay.clock_enabled %}checked{% endif %}>
            Show Clock
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_weather_enabled" {% if monitor_cfg.overlay and monitor_cfg.overlay.weather_enabled %}checked{% endif %}>
            Show Weather
          </label>
        </div>
        <div class="form-group">
          <label>Clock Font Size:</label>
          <input type="number" name="{{ monitor_name }}_clock_font_size" value="{{ monitor_cfg.overlay.clock_font_size if monitor_cfg.overlay and monitor_cfg.overlay.clock_font_size is defined else 26 }}">
        </div>
        <div class="form-group">
          <label>Weather Font Size:</label>
          <input type="number" name="{{ monitor_name }}_weather_font_size" value="{{ monitor_cfg.overlay.weather_font_size if monitor_cfg.overlay and monitor_cfg.overlay.weather_font_size is defined else 22 }}">
        </div>
        <div class="form-group">
          <label>Font Color:</label>
          <input type="color" name="{{ monitor_name }}_font_color" value="{{ monitor_cfg.overlay.font_color if monitor_cfg.overlay and monitor_cfg.overlay.font_color is defined else '#FFFFFF' }}">
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_auto_negative_font" {% if monitor_cfg.overlay and monitor_cfg.overlay.auto_negative_font %}checked{% endif %}>
            Auto Negative Font Color
          </label>
        </div>
        <!-- New: Weather Layout Selector -->
        <div class="form-group">
          <label>Weather Layout:</label>
          <div class="position-layout-selector" data-input-name="{{ monitor_name }}_weather_layout" style="display: flex; gap:10px;">
            <div class="layout-option {% if monitor_cfg.overlay and monitor_cfg.overlay.weather_layout == 'stacked' or monitor_cfg.overlay is not defined %}selected{% endif %}" data-value="stacked" style="width: 50px; height: 50px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor:pointer;">
              Stacked
            </div>
            <div class="layout-option {% if monitor_cfg.overlay and monitor_cfg.overlay.weather_layout == 'inline' %}selected{% endif %}" data-value="inline" style="width: 50px; height: 50px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor:pointer;">
              Inline
            </div>
          </div>
          <input type="hidden" name="{{ monitor_name }}_weather_layout" value="{{ monitor_cfg.overlay.weather_layout if monitor_cfg.overlay and monitor_cfg.overlay.weather_layout is defined else 'stacked' }}">
        </div>
        <!-- New: Clock/Weather Position Graphic Selector -->
        <div class="form-group">
          <label>Clock/Weather Position:</label>
          <div class="position-selector" data-input-name="{{ monitor_name }}_clock_weather_position" style="display: flex; flex-wrap: wrap; max-width: 150px;">
            <div class="pos-option {% if monitor_cfg.overlay and monitor_cfg.overlay.clock_weather_position == 'top-left' %}selected{% endif %}" data-value="top-left" style="width: 30px; height: 30px; margin: 5px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor:pointer;">
              <div style="width: 6px; height: 6px; border-radius: 50%; background: #000;"></div>
            </div>
            <div class="pos-option {% if monitor_cfg.overlay and monitor_cfg.overlay.clock_weather_position == 'top-center' %}selected{% endif %}" data-value="top-center" style="width: 30px; height: 30px; margin: 5px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor:pointer;">
              <div style="width: 6px; height: 6px; border-radius: 50%; background: #000;"></div>
            </div>
            <div class="pos-option {% if monitor_cfg.overlay and monitor_cfg.overlay.clock_weather_position == 'top-right' %}selected{% endif %}" data-value="top-right" style="width: 30px; height: 30px; margin: 5px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor:pointer;">
              <div style="width: 6px; height: 6px; border-radius: 50%; background: #000;"></div>
            </div>
            <div class="pos-option {% if monitor_cfg.overlay and monitor_cfg.overlay.clock_weather_position == 'bottom-left' %}selected{% endif %}" data-value="bottom-left" style="width: 30px; height: 30px; margin: 5px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor:pointer;">
              <div style="width: 6px; height: 6px; border-radius: 50%; background: #000;"></div>
            </div>
            <div class="pos-option {% if monitor_cfg.overlay and monitor_cfg.overlay.clock_weather_position == 'bottom-center' or monitor_cfg.overlay is not defined %}selected{% endif %}" data-value="bottom-center" style="width: 30px; height: 30px; margin: 5px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor:pointer;">
              <div style="width: 6px; height: 6px; border-radius: 50%; background: #000;"></div>
            </div>
            <div class="pos-option {% if monitor_cfg.overlay and monitor_cfg.overlay.clock_weather_position == 'bottom-right' %}selected{% endif %}" data-value="bottom-right" style="width: 30px; height: 30px; margin: 5px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; cursor:pointer;">
              <div style="width: 6px; height: 6px; border-radius: 50%; background: #000;"></div>
            </div>
          </div>
          <input type="hidden" name="{{ monitor_name }}_clock_weather_position" value="{{ monitor_cfg.overlay.clock_weather_position if monitor_cfg.overlay and monitor_cfg.overlay.clock_weather_position is defined else 'bottom-center' }}">
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_show_desc" {% if monitor_cfg.overlay and monitor_cfg.overlay.show_desc %}checked{% endif %}>
            Show Weather Description
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_show_temp" {% if monitor_cfg.overlay and monitor_cfg.overlay.show_temp %}checked{% endif %}>
            Show Temperature
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_show_feels_like" {% if monitor_cfg.overlay and monitor_cfg.overlay.show_feels_like %}checked{% endif %}>
            Show Feels Like Temperature
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="{{ monitor_name }}_show_humidity" {% if monitor_cfg.overlay and monitor_cfg.overlay.show_humidity %}checked{% endif %}>
            Show Humidity
          </label>
        </div>
      </div>
      {% endfor %}
    </div>
    <div style="text-align:center; margin-top:20px;">
      <button type="submit">Save All Overlay Settings</button>
    </div>
  </form>
  <script>
    // Handle graphic selectors for position and layout
    document.querySelectorAll('.position-selector').forEach(function(selector) {
      selector.querySelectorAll('.pos-option').forEach(function(option) {
        option.addEventListener('click', function() {
          // Remove selected class from siblings
          selector.querySelectorAll('.pos-option').forEach(function(sibling) {
            sibling.classList.remove('selected');
          });
          option.classList.add('selected');
          // Set the corresponding hidden input value
          var inputName = selector.getAttribute('data-input-name');
          var hiddenInput = document.querySelector('input[name="' + inputName + '"]');
          if (hiddenInput) {
            hiddenInput.value = option.getAttribute('data-value');
          }
        });
      });
    });
    document.querySelectorAll('.position-layout-selector').forEach(function(selector) {
      selector.querySelectorAll('.layout-option').forEach(function(option) {
        option.addEventListener('click', function() {
          selector.querySelectorAll('.layout-option').forEach(function(sibling) {
            sibling.classList.remove('selected');
          });
          option.classList.add('selected');
          var inputName = selector.getAttribute('data-input-name');
          var hiddenInput = document.querySelector('input[name="' + inputName + '"]');
          if (hiddenInput) {
            hiddenInput.value = option.getAttribute('data-value');
          }
        });
      });
    });
  </script>
</div>
{% endblock %}
